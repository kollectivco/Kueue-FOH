# ุชูุธูู ูุณุงุฑุงุช Subscription Plans ูู ุงูุฎุงุฏู

## ๐ ุงูููุฎุต
ุชู ุญุฐู ูุธุงู Organizations & Subscription Plans ุจุงููุงูู ูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ. ูุฌุจ ุงูุขู ุชูุธูู ุงููุณุงุฑุงุช ุงููุชุนููุฉ ุจูุฐุง ุงููุธุงู ูู ููู ุงูุฎุงุฏู.

## โ ูุง ุชู ุฅูุฌุงุฒู

### 1. ุฅุฒุงูุฉ ุงูุงุณุชูุฑุงุฏุงุช ุงูุฎุงุทุฆุฉ
- โ ุชู ุฅุฒุงูุฉ ุงุณุชูุฑุงุฏ `organizations-routes.tsx` (ุงูููู ุบูุฑ ููุฌูุฏ)
- โ ุชู ุฅุฒุงูุฉ ุงุณุชุฏุนุงุก `registerOrganizationsRoutes(app, verifyAuth)`

### 2. ุชูุธูู Cache System
- โ ุชู ุฅุฒุงูุฉ `plansCache` ู `PLANS_CACHE_TTL`
- โ ุชู ุฅุฒุงูุฉ ุฏุงูุฉ `invalidatePlansCache()`
- โ ุชู ุชุญุฏูุซ admin dashboard endpoint ูุฅุฒุงูุฉ ูุฑุงุฌุน `planList`

## ๐จ ุงููุณุงุฑุงุช ุงูุชู ูุฌุจ ุญุฐููุง

ูุฌุจ ุญุฐู ุฌููุน ูุณุงุฑุงุช Plans ุงูุชุงููุฉ ูู `/supabase/functions/server/index.tsx`:

### 1. POST `/make-server-6eefa08e/admin/plans`
**ุงููููุน**: ุญูุงูู ุงูุณุทุฑ 564-620  
**ุงููุธููุฉ**: ุฅูุดุงุก ุฎุทุฉ ุงุดุชุฑุงู ุฌุฏูุฏุฉ  
**ุงูุฅุฌุฑุงุก**: ุงุญุฐู ุงููุณุงุฑ ุจุงููุงูู

### 2. GET `/make-server-6eefa08e/admin/plans`
**ุงููููุน**: ุญูุงูู ุงูุณุทุฑ 611-662  
**ุงููุธููุฉ**: ุฌูุจ ุฌููุน ุงูุฎุทุท  
**ุงูุฅุฌุฑุงุก**: ุงุญุฐู ุงููุณุงุฑ ุจุงููุงูู

### 3. POST `/make-server-6eefa08e/admin/sync-plan`
**ุงููููุน**: ุญูุงูู ุงูุณุทุฑ 665-710  
**ุงููุธููุฉ**: ูุฒุงููุฉ ุฎุทุฉ ูู localStorage ุฅูู KV store  
**ุงูุฅุฌุฑุงุก**: ุงุญุฐู ุงููุณุงุฑ ุจุงููุงูู

### 4. PUT `/make-server-6eefa08e/admin/plans/:id`
**ุงููููุน**: ุญูุงูู ุงูุณุทุฑ 713-750  
**ุงููุธููุฉ**: ุชุญุฏูุซ ุฎุทุฉ ููุฌูุฏุฉ  
**ุงูุฅุฌุฑุงุก**: ุงุญุฐู ุงููุณุงุฑ ุจุงููุงูู

### 5. DELETE `/make-server-6eefa08e/admin/plans/:id`
**ุงููููุน**: ุญูุงูู ุงูุณุทุฑ 753-873  
**ุงููุธููุฉ**: ุญุฐู ุฎุทุฉ ูุงุญุฏุฉ  
**ุงูุฅุฌุฑุงุก**: ุงุญุฐู ุงููุณุงุฑ ุจุงููุงูู

### 6. POST `/make-server-6eefa08e/admin/plans/cleanup`
**ุงููููุน**: ุญูุงูู ุงูุณุทุฑ 876-1120  
**ุงููุธููุฉ**: ุชูุธูู ุงูุฎุทุท ุงูููุฑุฑุฉ  
**ุงูุฅุฌุฑุงุก**: ุงุญุฐู ุงููุณุงุฑ ุจุงููุงูู

### 7. POST `/make-server-6eefa08e/admin/plans/delete-all`
**ุงููููุน**: ุญูุงูู ุงูุณุทุฑ 1121-1191  
**ุงููุธููุฉ**: ุญุฐู ุฌููุน ุงูุฎุทุท  
**ุงูุฅุฌุฑุงุก**: ุงุญุฐู ุงููุณุงุฑ ุจุงููุงูู

### 8. GET `/make-server-6eefa08e/admin/plans/diagnose`
**ุงููููุน**: ุญูุงูู ุงูุณุทุฑ 4847-4934  
**ุงููุธููุฉ**: ุชุดุฎูุต ุงูุฎุทุท ุงูููุฑุฑุฉ  
**ุงูุฅุฌุฑุงุก**: ุงุญุฐู ุงููุณุงุฑ ุจุงููุงูู

## ๐ ุชูุธูู KV Store

ุจุนุฏ ุญุฐู ุงููุณุงุฑุงุชุ ูุฌุจ ุชูุธูู ุฃู ุจูุงูุงุช plans ูุชุจููุฉ ูู KV store:

```sql
-- Script ููุชูููุฐ ูู Supabase SQL Editor
-- ูุญุฐู ุฌููุน ููุงุชูุญ plans ูู kv_store_6eefa08e

DELETE FROM kv_store_6eefa08e 
WHERE key LIKE 'plan_%' 
   OR key LIKE 'subscription_plan_%';

-- ุงูุชุญูู ูู ุงูุชูุธูู
SELECT COUNT(*) as remaining_plans
FROM kv_store_6eefa08e 
WHERE key LIKE 'plan_%' 
   OR key LIKE 'subscription_plan_%';
```

## ๐ ุงููุฑุงุฌุน ุงูุฃุฎุฑู ุงูุชู ูุฌุจ ุชูุธูููุง

### ูู ูููุงุช ุงููุงุฌูุฉ ุงูุฃูุงููุฉ:

1. **GlobalDataStore.tsx**
   - ุฅุฒุงูุฉ `subscriptionPlan` ูู interface Organization (ุงูุณุทุฑ 22)
   - ุฅุฒุงูุฉ ุฏุงูุฉ `fetchPlans()` 
   - ุฅุฒุงูุฉ ูุฑุงุฌุน `kueue_subscription_plans` ูู localStorage

2. **Phase1Diagnostics.tsx**
   - ุฅุฒุงูุฉ ุงุณุชุฏุนุงุกุงุช `/admin/plans/diagnose` ู `/admin/plans/cleanup`

3. **SystemAdminPortal.tsx**
   - ุชุฃูุฏ ูู ุฅุฒุงูุฉ ุฌููุน ูุฑุงุฌุน Plans (ุชู ุจุงููุนู)

4. **BillingAdminPortalReal.tsx**
   - ุงูุฅุจูุงุก ุนูู `subscription_plan` ู `subscription_status` (ูุฐู ุจูุงูุงุช ุชุงุฑูุฎูุฉ ููุท)
   - ูุง ุชุชูุงุตู ูุน ูุณุงุฑุงุช Plans ุงููุญุฐููุฉ

## โ ุงูุฎุทูุงุช ุงูุชุงููุฉ

1. โ **ุชู**: ุฅุฒุงูุฉ ุงุณุชูุฑุงุฏ organizations-routes.tsx
2. โ **ุชู**: ุชูุธูู Plans cache system  
3. โ **ุชู**: ุชุญุฏูุซ admin dashboard endpoint
4. โณ **ุงููุทููุจ**: ุญุฐู ุฌููุน ุงููุณุงุฑุงุช ุงูู 8 ุงููุฐููุฑุฉ ุฃุนูุงู
5. โณ **ุงููุทููุจ**: ุชูุธูู KV store ูู ุจูุงูุงุช Plans
6. โณ **ุงููุทููุจ**: ุชูุธูู ูุฑุงุฌุน plans ูู ูููุงุช ุงููุงุฌูุฉ ุงูุฃูุงููุฉ

## ๐ฏ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

ุจุนุฏ ุฅููุงู ุฌููุน ุงูุฎุทูุงุช:
- โ ูู ุชูุฌุฏ ูุณุงุฑุงุช plans ูู ุงูุฎุงุฏู
- โ ูู ุชูุฌุฏ ุจูุงูุงุช plans ูู KV store
- โ ูู ุชูุฌุฏ ูุฑุงุฌุน plans ูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ (ุฅูุง ุงูุจูุงูุงุช ุงูุชุงุฑูุฎูุฉ ูู Billing)
- โ ุณูุนูู ุงููุธุงู ุจุดูู ุทุจูุนู ุจุฏูู ูุธุงู Subscription Plans

## ๐ ููุงุญุธุงุช ูููุฉ

- ุชุฃูุฏ ูู ุนูู backup ูููููุงุช ูุจู ุงูุญุฐู
- ูุณุงุฑุงุช Organizations ูุฌุจ ุฃู ุชุจูู (GET, POST, PUT ูู `/admin/organizations`)
- ูุณุงุฑุงุช Feature Flags ูุฌุจ ุฃู ุชุจูู
- ูุณุงุฑุงุช ุงูู audit logs ูุฌุจ ุฃู ุชุจูู

---

**ุชุงุฑูุฎ ุงูุฅูุดุงุก**: 2025-10-23  
**ุงูุญุงูุฉ**: ููุฏ ุงูุชูููุฐ โณ
